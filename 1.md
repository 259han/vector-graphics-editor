流程图连接线的两种创建方式分析
在本项目中，流程图连接线（FlowchartConnectorItem）可以通过两种主要方式创建：
通过 AutoConnectState 进行自动连接
通过 DrawState (GraphicItem::FLOWCHART_CONNECTOR) 进行手动绘制
这两种方式在用户交互、连接逻辑和创建过程上存在显著差异。
1. 通过 AutoConnectState 进行自动连接
AutoConnectState (src/state/auto_connect_state.h, src/state/auto_connect_state.cpp) 专门用于实现流程图元素之间的智能连接。
用户交互: 用户点击“自动连接”工具按钮进入此状态。然后，用户需要点击一个流程图元素的连接点（源点），按住鼠标并拖拽到另一个流程图元素的连接点（目标点），最后释放鼠标。
连接逻辑: AutoConnectState 在 mouseMoveEvent 和 mouseReleaseEvent 中会主动查找鼠标位置下方的流程图元素及其可用的连接点 (ConnectionManager::findConnectionPointAt)。连接的创建是基于找到的源连接点和目标连接点进行的。它会检查连接点是否已被占用 (!point->isOccupied)。
预览: 在拖拽过程中，会创建一个临时的虚线预览连接线 (m_previewConnector)，显示从源连接点到当前鼠标位置的连线。
最终创建: 连接成功时，AutoConnectState 会创建一个 ConnectionCommand 对象。这个命令包含了源/目标流程图元素、源/目标连接点索引，以及当前选择的连接线类型 (m_connectorType) 和箭头类型 (m_arrowType)。ConnectionCommand 通过 ConnectionManager 负责实际创建 FlowchartConnectorItem 并建立连接关系。
样式确定: 连接线类型（直线、折线、曲线）和箭头类型（无、单箭头、双箭头）由 MainWindow 中流程图工具栏上的 ComboBox 选择决定，并通过 DrawArea 传递给 AutoConnectState 实例。AutoConnectState 在创建 ConnectionCommand 时会使用这些样式设置。
总结 AutoConnectState 的特点:
智能: 专注于连接流程图元素之间的特定连接点。
基于连接点: 连接的起点和终点必须是流程图元素上预定义的连接点。
命令模式: 使用 ConnectionCommand，支持撤销/重做连接操作。
样式可配置: 支持创建不同类型（直线、折线、曲线）和箭头样式的连接线，样式由 UI 选择控制。
2. 通过 DrawState (GraphicItem::FLOWCHART_CONNECTOR) 进行手动绘制
DrawState (src/state/draw_state.h, src/state/draw_state.cpp) 是一个通用的绘图状态，当图形类型设置为 GraphicItem::FLOWCHART_CONNECTOR 时，它允许用户像绘制普通直线一样绘制连接线。
用户交互: 用户点击流程图工具栏上的“连接器”按钮进入此状态。然后，用户在画布上点击一个点（起点），按住鼠标并拖拽到另一个点（终点），最后释放鼠标。
连接逻辑: DrawState 在 mousePressEvent 中记录起点 (m_startPoint)，在 mouseMoveEvent 中更新当前点 (m_currentPoint)，并在 mouseReleaseEvent 中使用这两个点来创建图形。这个过程不涉及查找或连接到其他流程图元素的特定连接点。它只是在用户指定的两个点之间绘制一条线。
预览: 在拖拽过程中，DrawState::updatePreviewItem 会创建一个临时的 QGraphicsPathItem，绘制一条从 m_startPoint 到 m_currentPoint 的虚线，并根据 DrawArea 中保存的当前箭头类型 (drawArea->getArrowType()) 在终点（如果箭头类型是单箭头或双箭头）或起点和终点（如果箭头类型是双箭头）绘制箭头预览。
最终创建: 鼠标释放时，DrawState 会创建一个 CreateGraphicCommand 对象。这个命令包含了图形类型 (GraphicItem::FLOWCHART_CONNECTOR)、起点和终点 (m_startPoint, m_currentPoint)，以及当前的画笔和画刷样式。CreateGraphicCommand 通过 GraphicsItemFactory 负责创建 FlowchartConnectorItem。
样式确定: DrawState 在创建 CreateGraphicCommand 时，会使用当前的画笔颜色 (m_lineColor) 和线宽 (m_lineWidth)。然而，从 DrawState::updatePreviewItem 和 DrawState::createFinalItem 的实现来看，通过这种方式创建的连接线似乎总是基于起点和终点绘制的直线，并且只应用了箭头样式 (drawArea->getArrowType())。 它没有使用 DrawArea 中保存的 m_connectorType（直线、折线、曲线）来影响最终连接线的形状。这意味着通过这种方式绘制的连接线可能只支持直线类型，即使工具栏上选择了折线或曲线。
总结 DrawState (FLOWCHART_CONNECTOR) 的特点:
手动绘制: 像绘制普通图形一样，用户自由指定起点和终点。
不依赖连接点: 连接不强制吸附或连接到流程图元素的连接点。
命令模式: 使用 CreateGraphicCommand，支持撤销/重做创建操作。
样式受限: 似乎只创建直线连接线，但支持应用箭头样式。
区别总结
| 特性 | AutoConnectState (自动连接) | DrawState (GraphicItem::FLOWCHART_CONNECTOR) (手动绘制) |
| :----------- | :------------------------------------------------ | :-------------------------------------------------------- |
| 用户交互 | 点击源连接点 -> 拖拽到目标连接点 -> 释放 | 点击起点 -> 拖拽到终点 -> 释放 |
| 连接逻辑 | 查找并连接到流程图元素的特定连接点 | 仅在用户指定的两个点之间绘制直线 |
| 依赖关系 | 必须连接到流程图元素上的可用连接点 | 不强制连接到任何其他图形或连接点 |
| 命令类型 | ConnectionCommand | CreateGraphicCommand |
| 线条类型 | 支持直线、折线、曲线 (取决于 UI 选择) | 似乎只创建直线 |
| 箭头样式 | 支持无、单箭头、双箭头 (取决于 UI 选择) | 支持无、单箭头、双箭头 (取决于 UI 选择) |
| 主要用途 | 连接流程图元素，建立逻辑关系 | 绘制独立的带箭头的直线，可能用于非流程图连接或特殊情况 |
结论:
“一个有自动连接一个没有”的连接线，是指通过 AutoConnectState 创建的连接线（支持智能连接到元素连接点，并可能支持折线/曲线样式）和通过 DrawState (GraphicItem::FLOWCHART_CONNECTOR) 手动绘制的直线连接线（只在两点间绘制直线，不智能连接到元素）。
AutoConnectState 提供了更符合流程图绘制习惯的“自动连接”功能，它能够识别流程图元素并吸附到连接点，并且支持不同的连接线形状。而 DrawState 中的 FLOWCHART_CONNECTOR 模式更像是一个基本的带箭头的直线绘制工具。